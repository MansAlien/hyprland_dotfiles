var dr=Object.defineProperty;var mr=(S,w,v)=>w in S?dr(S,w,{enumerable:!0,configurable:!0,writable:!0,value:v}):S[w]=v;var j=(S,w,v)=>(mr(S,typeof w!="symbol"?w+"":w,v),v),ce=(S,w,v)=>{if(!w.has(S))throw TypeError("Cannot "+v)};var Y=(S,w,v)=>(ce(S,w,"read from private field"),v?v.call(S):w.get(S)),U=(S,w,v)=>{if(w.has(S))throw TypeError("Cannot add the same private member more than once");w instanceof WeakSet?w.add(S):w.set(S,v)},Te=(S,w,v,z)=>(ce(S,w,"write to private field"),z?z.call(S,v):w.set(S,v),v);var ge=(S,w,v)=>(ce(S,w,"access private method"),v);(function(){"use strict";var K,F,Q,V,X,ee,ke,re,Ce;function S(t){return t}function w(t,...e){const r=["background-color: red; color: white; padding: 0px 6px; border-radius: 3px; margin-right: 4px;","background-color: #80808048; color: white; padding: 2px 4px; border-radius: 3px"];if(typeof e[0]=="string"){const n=[...e];t(`%c▶%cYT Ad Blocker%c ${n.shift()}`,...r,"",...n)}else t("%c▶%cYT Ad Blocker",...r,...e)}const v={debug:(...t)=>w(console.debug,...t),log:(...t)=>w(console.log,...t),warn:(...t)=>w(console.warn,...t),error:(...t)=>w(console.error,...t)};function z(t,e){return new Promise(r=>{let n=e.querySelector(t);if(n)return r(n);const a=new MutationObserver(()=>{n=e.querySelector(t),n&&(r(n),a.disconnect())});a.observe(e,{childList:!0,subtree:!0})})}function Ie(t){document.readyState==="complete"?t():window.addEventListener("load",t,{once:!0})}function Le(t){const e=new MutationObserver(r=>{r.forEach(n=>{for(const a of Array.from(n.addedNodes))a.nodeName==="HEAD"&&(t(),e.disconnect())})});e.observe(document,{childList:!0,subtree:!0})}v.log("Loaded: assets/youtube-ad-skipper.ts");class Me{constructor(){j(this,"domObserver");j(this,"playerListeners");v.debug("[ADBLOCK] PlayerObserver.constructor"),this.playerListeners=[]}addListener(e){let r=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return this.playerListeners.push({callback:e,id:r}),this.start(),()=>{this.playerListeners=this.playerListeners.filter(n=>n.id!==r),v.debug("[ADBLOCK] removing player listener",r,this.playerListeners),this.playerListeners.length===0&&this.stop()}}sendEvent(e){if(this.playerListeners.length==0){this.stop();return}this.playerListeners.forEach(r=>{r.callback(e)})}notifyPlayerDetected(e){v.debug("[ADBLOCK] PlayerObserver.notifyPlayerDetected"),this.sendEvent({type:"player-detected",player:e})}notifyPlayerMutations(e,r){v.debug("[ADBLOCK] PlayerObserver.notifyPlayerMutation"),this.sendEvent({type:"player-mutations",player:e,mutations:r})}start(){this.domObserver===void 0&&(v.debug("[ADBLOCK] PlayerObserver.start"),Ie(()=>{const e=window.parent===window?"ytd-player#ytd-player .html5-video-player":".html5-video-player";z(e,document.body).then(r=>{var a;this.notifyPlayerDetected(r);const n=(d,u)=>{this.notifyPlayerMutations(r,d)};this.domObserver=new MutationObserver(n),(a=this.domObserver)==null||a.observe(r,{subtree:!0,childList:!0,attributeFilter:["src"]})})}))}stop(){var e;v.debug("[ADBLOCK] PlayerObserver.stop"),(e=this.domObserver)==null||e.disconnect(),delete this.domObserver}}const Oe=new Me;function Pe(t){return Oe.addListener(t)}class _e{constructor(e,r=()=>{},n=!0){j(this,"removePlayerEventListener");j(this,"adTrackingFn");this.logger=e,this.adTrackingFn=r,n&&this.start()}enable(){var e;(e=this.logger)==null||e.debug("[ADBLOCK] enable"),this.start()}disable(){var e;(e=this.logger)==null||e.debug("[ADBLOCK] disable"),this.stop()}checkForAdToSkip(e){var a,d,u;if((a=this.logger)==null||a.debug("[ADBLOCK] AdSkipper checking for ad"),!e.classList.contains("ad-showing"))return;const r=e.querySelector("video");if(!r)return;const n=e.querySelector(".ytp-ad-skip-button, .ytp-ad-skip-button-modern");n?((d=this.logger)==null||d.debug("[ADBLOCK] ad skip button clicked",n),r.duration>0&&r.currentTime<r.duration-.5&&(r.currentTime=r.duration-.5,this.adTrackingFn(document.location.toString(),1)),n.offsetParent!==null&&n.click()):isNaN(r.duration)?r.currentTime=0:r.duration>0&&r.currentTime<r.duration-.5&&(r.currentTime=r.duration-.5,this.adTrackingFn(document.location.toString(),1),(u=this.logger)==null||u.debug("[ADBLOCK] video ad skipped",n))}start(){this.removePlayerEventListener===void 0&&(this.removePlayerEventListener=Pe(e=>{let r=e.type;switch(r){case"player-detected":const n=document.querySelector("ytd-display-ad-renderer");n&&(n.closest("ytd-rich-item-renderer").style.display="none"),this.checkForAdToSkip(e.player);break;case"player-mutations":this.checkForAdToSkip(e.player);break;default:const a=r;throw new Error(`Unhandled color case: ${a}`)}}))}stop(){var e;(e=this.removePlayerEventListener)==null||e.call(this),delete this.removePlayerEventListener}}const de={fas_adblocker:"",fas_site:"youtube"},De=[".ytd-compact-promoted-video-renderer",".ytd-promoted-sparkles-web-renderer",".ytd-promoted-sparkles-text-search-renderer",".ytd-compact-promoted-item-renderer",".ytd-promoted-video-renderer",".ytd-ad-slot-renderer",".ytd-banner-promo-renderer",".yt-mealbar-promo-renderer",".ytd-brand-video-singleton-renderer",".ytd-statement-banner-renderer",".ytd-action-companion-ad-renderer","ytd-engagement-panel-section-list-renderer[target-id='engagement-panel-ads']","ytd-ad-slot-renderer"];function Ne(){const t=De.map(n=>`${n}:not(.hidden-tracked)`).join(","),e=document.querySelectorAll(t);let r=0;return e.forEach(n=>{n instanceof HTMLElement&&n.offsetParent===null&&window.getComputedStyle(n.parentNode).display!=="none"&&r++,n.classList.add("hidden-tracked")}),r}class $e{constructor(e,r){j(this,"interval");this.logger=e,this.adTrackingFn=r}enable(){var e;(e=this.logger)==null||e.debug("Enabling CSS adblock..."),Object.entries(de).forEach(([r,n])=>{document.documentElement.setAttribute(r,n)}),this.interval=setInterval(()=>{var n;const r=Ne();(n=this.logger)==null||n.debug(`[ADBLOCK] hidden elements: ${r}`),this.adTrackingFn(document.location.toString(),r)},1e3)}disable(){var e;(e=this.logger)==null||e.debug("Disabling CSS adblock..."),clearInterval(this.interval),Object.keys(de).forEach(r=>{document.documentElement.removeAttribute(r)})}}function je(t){const{logger:e,adTrackingFn:r}=t,n=new _e(e,r??(()=>{}));e==null||e.debug("Created the ad skipper:",n);const a=new $e(e,r??(()=>{}));return e==null||e.debug("Created the CSS adblocker:",a),{enable:()=>{e==null||e.debug("[ADBLOCK] enable"),n.enable(),a.enable()},disable:()=>{e==null||e.debug("[ADBLOCK] disable"),n.disable(),a.disable()}}}var Re=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var me={exports:{}};(function(t,e){(function(r,n){n(t)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Re,function(r){var n,a;if(!((a=(n=globalThis.chrome)==null?void 0:n.runtime)!=null&&a.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const d="The message port closed before a response was received.",u=b=>{const x={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(x).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class A extends WeakMap{constructor(g,m=void 0){super(m),this.createItem=g}get(g){return this.has(g)||this.set(g,this.createItem(g)),super.get(g)}}const E=c=>c&&typeof c=="object"&&typeof c.then=="function",T=(c,g)=>(...m)=>{b.runtime.lastError?c.reject(new Error(b.runtime.lastError.message)):g.singleCallbackArg||m.length<=1&&g.singleCallbackArg!==!1?c.resolve(m[0]):c.resolve(m)},P=c=>c==1?"argument":"arguments",R=(c,g)=>function(y,...k){if(k.length<g.minArgs)throw new Error(`Expected at least ${g.minArgs} ${P(g.minArgs)} for ${c}(), got ${k.length}`);if(k.length>g.maxArgs)throw new Error(`Expected at most ${g.maxArgs} ${P(g.maxArgs)} for ${c}(), got ${k.length}`);return new Promise((M,_)=>{if(g.fallbackToNoCallback)try{y[c](...k,T({resolve:M,reject:_},g))}catch(f){console.warn(`${c} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,f),y[c](...k),g.fallbackToNoCallback=!1,g.noCallback=!0,M()}else g.noCallback?(y[c](...k),M()):y[c](...k,T({resolve:M,reject:_},g))})},o=(c,g,m)=>new Proxy(g,{apply(y,k,M){return m.call(k,c,...M)}});let i=Function.call.bind(Object.prototype.hasOwnProperty);const s=(c,g={},m={})=>{let y=Object.create(null),k={has(_,f){return f in c||f in y},get(_,f,D){if(f in y)return y[f];if(!(f in c))return;let I=c[f];if(typeof I=="function")if(typeof g[f]=="function")I=o(c,c[f],g[f]);else if(i(m,f)){let q=R(f,m[f]);I=o(c,c[f],q)}else I=I.bind(c);else if(typeof I=="object"&&I!==null&&(i(g,f)||i(m,f)))I=s(I,g[f],m[f]);else if(i(m,"*"))I=s(I,g[f],m["*"]);else return Object.defineProperty(y,f,{configurable:!0,enumerable:!0,get(){return c[f]},set(q){c[f]=q}}),I;return y[f]=I,I},set(_,f,D,I){return f in y?y[f]=D:c[f]=D,!0},defineProperty(_,f,D){return Reflect.defineProperty(y,f,D)},deleteProperty(_,f){return Reflect.deleteProperty(y,f)}},M=Object.create(c);return new Proxy(M,k)},l=c=>({addListener(g,m,...y){g.addListener(c.get(m),...y)},hasListener(g,m){return g.hasListener(c.get(m))},removeListener(g,m){g.removeListener(c.get(m))}}),h=new A(c=>typeof c!="function"?c:function(m){const y=s(m,{},{getContent:{minArgs:0,maxArgs:0}});c(y)}),p=new A(c=>typeof c!="function"?c:function(m,y,k){let M=!1,_,f=new Promise(W=>{_=function(N){M=!0,W(N)}}),D;try{D=c(m,y,_)}catch(W){D=Promise.reject(W)}const I=D!==!0&&E(D);if(D!==!0&&!I&&!M)return!1;const q=W=>{W.then(N=>{k(N)},N=>{let le;N&&(N instanceof Error||typeof N.message=="string")?le=N.message:le="An unexpected error occurred",k({__mozWebExtensionPolyfillReject__:!0,message:le})}).catch(N=>{console.error("Failed to send onMessage rejected reply",N)})};return q(I?D:f),!0}),O=({reject:c,resolve:g},m)=>{b.runtime.lastError?b.runtime.lastError.message===d?g():c(new Error(b.runtime.lastError.message)):m&&m.__mozWebExtensionPolyfillReject__?c(new Error(m.message)):g(m)},L=(c,g,m,...y)=>{if(y.length<g.minArgs)throw new Error(`Expected at least ${g.minArgs} ${P(g.minArgs)} for ${c}(), got ${y.length}`);if(y.length>g.maxArgs)throw new Error(`Expected at most ${g.maxArgs} ${P(g.maxArgs)} for ${c}(), got ${y.length}`);return new Promise((k,M)=>{const _=O.bind(null,{resolve:k,reject:M});y.push(_),m.sendMessage(...y)})},C={devtools:{network:{onRequestFinished:l(h)}},runtime:{onMessage:l(p),onMessageExternal:l(p),sendMessage:L.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:L.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return x.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},s(b,C,x)};r.exports=u(chrome)}else r.exports=globalThis.browser})})(me);var Be=me.exports;const B=Fe(Be);var ue=Object.prototype.hasOwnProperty;function te(t,e){var r,n;if(t===e)return!0;if(t&&e&&(r=t.constructor)===e.constructor){if(r===Date)return t.getTime()===e.getTime();if(r===RegExp)return t.toString()===e.toString();if(r===Array){if((n=t.length)===e.length)for(;n--&&te(t[n],e[n]););return n===-1}if(!r||typeof t=="object"){n=0;for(r in t)if(ue.call(t,r)&&++n&&!ue.call(e,r)||!(r in e)||!te(t[r],e[r]))return!1;return Object.keys(e).length===n}}return t!==t&&e!==e}var Ae=B,fe=Ke();function Ke(){const t={local:G("local"),session:G("session"),sync:G("sync"),managed:G("managed")},e=o=>{const i=t[o];if(i==null){const s=Object.keys(t).join(", ");throw Error(`Invalid area "${o}". Options: ${s}`)}return i},r=o=>{const i=o.indexOf(":"),s=o.substring(0,i),l=o.substring(i+1);if(l==null)throw Error(`Storage key should be in the form of "area:key", but recieved "${o}"`);return{driverArea:s,driverKey:l,driver:e(s)}},n=o=>o+"$",a=(o,i)=>o??i??null,d=o=>typeof o=="object"&&!Array.isArray(o)?o:{},u=async(o,i,s)=>{const l=await o.getItem(i);return a(l,s==null?void 0:s.defaultValue)},b=async(o,i)=>{const s=n(i),l=await o.getItem(s);return d(l)},x=async(o,i,s)=>{await o.setItem(i,s??null)},A=async(o,i,s)=>{const l=n(i),p={...d(await o.getItem(l))};Object.entries(s).forEach(([O,L])=>{L==null?delete p[O]:p[O]=L}),await o.setItem(l,p)},E=async(o,i,s)=>{if(await o.removeItem(i),s!=null&&s.removeMeta){const l=n(i);await o.removeItem(l)}},T=async(o,i,s)=>{const l=n(i);if(s==null)await o.removeItem(l);else{const h=d(await o.getItem(l));[s].flat().forEach(p=>delete h[p]),await o.setItem(l,h)}},P=(o,i,s)=>o.watch(i,s);return{getItem:async(o,i)=>{const{driver:s,driverKey:l}=r(o);return await u(s,l,i)},getItems:async o=>{const i=new Map,s=new Map;return o.forEach(h=>{let p,O;typeof h=="string"?p=h:(p=h.key,O=h.options);const{driverArea:L,driverKey:C}=r(p),$=i.get(L)??[];i.set(L,$.concat(C)),s.set(p,O)}),(await Promise.all(Array.from(i.entries()).map(async([h,p])=>(await t[h].getItems(p)).map(L=>{var c;const C=`${h}:${L.key}`,$=a(L.value,(c=s.get(C))==null?void 0:c.defaultValue);return{key:C,value:$}})))).flat()},getMeta:async o=>{const{driver:i,driverKey:s}=r(o);return await b(i,s)},setItem:async(o,i)=>{const{driver:s,driverKey:l}=r(o);await x(s,l,i)},setItems:async o=>{const i=new Map;o.forEach(({key:s,value:l})=>{const{driverArea:h,driverKey:p}=r(s),O=i.get(h)??[];i.set(h,O.concat({key:p,value:l}))}),await Promise.all(Array.from(i.entries()).map(async([s,l])=>{await e(s).setItems(l)}))},setMeta:async(o,i)=>{const{driver:s,driverKey:l}=r(o);await A(s,l,i)},removeItem:async(o,i)=>{const{driver:s,driverKey:l}=r(o);await E(s,l,i)},removeItems:async o=>{const i=new Map;o.forEach(s=>{let l,h;typeof s=="string"?l=s:(l=s.key,h=s.options);const{driverArea:p,driverKey:O}=r(l),L=i.get(p)??[];L.push(O),h!=null&&h.removeMeta&&L.push(n(O)),i.set(p,L)}),await Promise.all(Array.from(i.entries()).map(async([s,l])=>{await e(s).removeItems(l)}))},removeMeta:async(o,i)=>{const{driver:s,driverKey:l}=r(o);await T(s,l,i)},snapshot:async(o,i)=>{var h;const l=await e(o).snapshot();return(h=i==null?void 0:i.excludeKeys)==null||h.forEach(p=>{delete l[p],delete l[n(p)]}),l},restoreSnapshot:async(o,i)=>{await e(o).restoreSnapshot(i)},watch:(o,i)=>{const{driver:s,driverKey:l}=r(o);return P(s,l,i)},unwatch(){Object.values(t).forEach(o=>{o.unwatch()})},defineItem:(o,i)=>{const{driver:s,driverKey:l}=r(o),{version:h=1,migrations:p={}}=i??{};if(h<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");return{_migrationsCompleted:(async()=>{var y;const[C,$]=await Promise.all([u(s,l,void 0),b(s,l)]);if(C==null)return;const c=$.v??1;if(c>h)throw Error(`[wxt/storage] Migration ignored for "${o}", version downgrade detected (${c} -> ${h})`);const g=Array.from({length:h-c},(k,M)=>c+M+1);let m=C;for(const k of g)m=await((y=p==null?void 0:p[k])==null?void 0:y.call(p,m))??m;await Promise.all([x(s,l,m),A(s,l,{v:h})])})(),getValue:()=>u(s,l,i),getMeta:()=>b(s,l),setValue:C=>x(s,l,C),setMeta:C=>A(s,l,C),removeValue:C=>E(s,l,C),removeMeta:C=>T(s,l,C),watch:C=>P(s,l,C)}}}}function G(t){const e=()=>{if(Ae.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");return Ae.storage[t]},r=new Set;return{getItem:async n=>(await e().get(n))[n],getItems:async n=>{const a=await e().get(n);return n.map(d=>({key:d,value:a[d]??null}))},setItem:async(n,a)=>{a==null?await e().remove(n):await e().set({[n]:a})},setItems:async n=>{const a=n.reduce((d,{key:u,value:b})=>(d[u]=b,d),{});await e().set(a)},removeItem:async n=>{await e().remove(n)},removeItems:async n=>{await e().remove(n)},snapshot:async()=>await e().get(),restoreSnapshot:async n=>{await e().set(n)},watch(n,a){const d=u=>{const b=u[n];b!=null&&(te(b.newValue,b.oldValue)||a(b.newValue??null,b.oldValue??null))};return e().onChanged.addListener(d),r.add(d),()=>{e().onChanged.removeListener(d),r.delete(d)}},unwatch(){r.forEach(n=>{e().onChanged.removeListener(n)}),r.clear()}}}const be=fe.defineItem("local:youtubeAdblockDisabled",{defaultValue:!1}),ne=fe.defineItem("local:youtubeDetectedAdsLog",{defaultValue:{tabInfos:{},total:0}});var se=B;const Ve=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(t=>[t.name,t]),qe=new Map(Ve);class ae extends Error{constructor(r){super(ae._prepareSuperMessage(r));j(this,"name","NonError")}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}}const Ue=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],oe=new WeakSet,We=t=>{oe.add(t);const e=t.toJSON();return oe.delete(t),e},he=t=>qe.get(t)??Error,ie=({from:t,seen:e,to:r,forceEnumerable:n,maxDepth:a,depth:d,useToJSON:u,serialize:b})=>{if(!r)if(Array.isArray(t))r=[];else if(!b&&ye(t)){const A=he(t.name);r=new A}else r={};if(e.push(t),d>=a)return r;if(u&&typeof t.toJSON=="function"&&!oe.has(t))return We(t);const x=A=>ie({from:A,seen:[...e],forceEnumerable:n,maxDepth:a,depth:d,useToJSON:u,serialize:b});for(const[A,E]of Object.entries(t)){if(E&&E instanceof Uint8Array&&E.constructor.name==="Buffer"){r[A]="[object Buffer]";continue}if(E!==null&&typeof E=="object"&&typeof E.pipe=="function"){r[A]="[object Stream]";continue}if(typeof E!="function"){if(!E||typeof E!="object"){try{r[A]=E}catch{}continue}if(!e.includes(t[A])){d++,r[A]=x(t[A]);continue}r[A]="[Circular]"}}for(const{property:A,enumerable:E}of Ue)typeof t[A]<"u"&&t[A]!==null&&Object.defineProperty(r,A,{value:ye(t[A])?x(t[A]):t[A],enumerable:n?!0:E,configurable:!0,writable:!0});return r};function Ye(t,e={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:n=!0}=e;return typeof t=="object"&&t!==null?ie({from:t,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:n,serialize:!0}):typeof t=="function"?`[Function: ${t.name||"anonymous"}]`:t}function ze(t,e={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=e;if(t instanceof Error)return t;if(Ge(t)){const n=he(t.name);return ie({from:t,seen:[],to:new n,maxDepth:r,depth:0,serialize:!1})}return new ae(t)}function ye(t){return!!t&&typeof t=="object"&&"name"in t&&"message"in t&&"stack"in t}function Ge(t){return!!t&&typeof t=="object"&&"message"in t&&!Array.isArray(t)}var Je=Object.defineProperty,He=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,pe=Object.getOwnPropertySymbols,Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,ve=(t,e,r)=>e in t?Je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,we=(t,e)=>{for(var r in e||(e={}))Qe.call(e,r)&&ve(t,r,e[r]);if(pe)for(var r of pe(e))Xe.call(e,r)&&ve(t,r,e[r]);return t},xe=(t,e)=>He(t,Ze(e)),er=(t,e,r)=>new Promise((n,a)=>{var d=x=>{try{b(r.next(x))}catch(A){a(A)}},u=x=>{try{b(r.throw(x))}catch(A){a(A)}},b=x=>x.done?n(x.value):Promise.resolve(x.value).then(d,u);b((r=r.apply(t,e)).next())});function rr(t){let e,r={};function n(){Object.entries(r).length===0&&(e==null||e(),e=void 0)}let a=Math.floor(Math.random()*1e4);function d(){return a++}return{sendMessage(u,b,...x){return er(this,null,function*(){var A,E;const T={id:d(),type:u,data:b,timestamp:Date.now()};(A=t.logger)==null||A.debug(`[messaging] sendMessage {id=${T.id}} ─ᐅ`,T,...x);const P=yield t.sendMessage(T,...x),{res:R,err:o}=P??{err:new Error("No response")};if((E=t.logger)==null||E.debug(`[messaging] sendMessage {id=${T.id}} ᐊ─`,{res:R,err:o}),o!=null)throw ze(o);return R})},onMessage(u,b){var x,A,E;if(e==null&&((x=t.logger)==null||x.debug(`[messaging] "${u}" initialized the message listener for this context`),e=t.addRootListener(T=>{var P,R;if(typeof T.type!="string"||typeof T.timestamp!="number"){const s=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(T)}`);throw(P=t.logger)==null||P.error(s),s}(R=t==null?void 0:t.logger)==null||R.debug("[messaging] Received message",T);const o=r[T.type];if(o==null)return;const i=o(T);return Promise.resolve(i).then(s=>{var l;return(l=t==null?void 0:t.logger)==null||l.debug(`[messaging] onMessage {id=${T.id}} ─ᐅ`,{res:s}),{res:s}}).catch(s=>{var l;return(l=t==null?void 0:t.logger)==null||l.debug(`[messaging] onMessage {id=${T.id}} ─ᐅ`,{err:s}),{err:Ye(s)}})})),r[u]!=null){const T=Error(`[messaging] In this JS context, only one listener can be setup for ${u}`);throw(A=t.logger)==null||A.error(T),T}return r[u]=b,(E=t.logger)==null||E.log(`[messaging] Added listener for ${u}`),()=>{delete r[u],n()}},removeAllListeners(){Object.keys(r).forEach(u=>{delete r[u]}),n()}}}function tr(t){return rr(xe(we({},t),{sendMessage(e,r){return r==null?B.runtime.sendMessage(e):B.tabs.sendMessage(r,e)},addRootListener(e){const r=(n,a)=>e(typeof n=="object"?xe(we({},n),{sender:a}):n);return B.runtime.onMessage.addListener(r),()=>B.runtime.onMessage.removeListener(r)}}))}function nr(){const t="request-tab-id",{sendMessage:e,onMessage:r}=tr();return{getCurrentTabId:async()=>await e(t,{}),startCurrentTabIdProvider:()=>{if(se.action===void 0)throw new Error("This should only be called in the background script");r(t,({sender:n})=>{var a;return(a=n.tab)==null?void 0:a.id})}}}function Ee(t){try{return new URL(t).hostname}catch{return""}}function J(t){return{removingAllTabInfos(){return{tabInfos:{},total:t.total}},removingTabInfo(e){const r={...t},n={...r.tabInfos};return delete n[e],r.tabInfos=n,r},incrementingCounter(e,r,n){const a={...t},d=a.tabInfos[e]??{url:r,counter:0};return d.counter+=n,a.tabInfos[e]=d,a.total+=n,a},updatedOnDomainChange(e,r){const n={...t},a=n.tabInfos[e];if(a!==void 0&&Ee(a.url)!==Ee(r))return delete n.tabInfos[e],n}}}function sr(){const{getCurrentTabId:t}=nr();function e(){return ne.getValue()}async function r(a){await ne.setValue(a)}function n(a){ne.watch(d=>{d&&a(d)})}return{async resetTabInfos(){r(J(await e()).removingAllTabInfos())},async removeTabInfo(a){r(J(await e()).removingTabInfo(a))},async trackDetectedAds(a,d){let u=await t();r(J(await e()).incrementingCounter(u,a,d))},async updateTabDomain(a){const d=await t(),u=J(await e()).updatedOnDomainChange(d,a);u!==void 0&&r(u)},async onLogChange(a){return n(a),await e()}}}const ar={matches:["*://*/*"],runAt:"document_start",allFrames:!0,main(){v.log("Loaded: youtube-ad-blocker.content.ts");const{updateTabDomain:t,trackDetectedAds:e}=sr();window.parent==window&&t(window.location.toString()),location.hostname.includes("youtube")&&Le(()=>{r()});async function r(){const n=(b,x)=>{x>0&&e(b,x)},{enable:a,disable:d}=je({logger:v,adTrackingFn:n});await be.getValue()===!0?d():a(),be.watch(b=>{b===!0?(d(),document.location.reload()):(a(),document.location.reload())})}}};function H(t,...e){}var or={debug:(...t)=>H(console.debug,...t),log:(...t)=>H(console.log,...t),warn:(...t)=>H(console.warn,...t),error:(...t)=>H(console.error,...t)},ir=(K=class extends Event{constructor(e,r){super(K.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=r}},j(K,"EVENT_NAME",Se("wxt:locationchange")),K);function Se(t){return`${se.runtime.id}:youtube-ad-blocker:${t}`}function lr(t){let e,r;return{run(){e==null&&(r=new URL(location.href),e=t.setInterval(()=>{let n=new URL(location.href);n.href!==r.href&&(window.dispatchEvent(new ir(n,r)),r=n)},1e3))}}}var cr=(F=class{constructor(e,r){U(this,ee);U(this,re);U(this,Q,window.self===window.top);U(this,V,void 0);U(this,X,lr(this));this.contentScriptName=e,this.options=r,Te(this,V,new AbortController),Y(this,Q)&&ge(this,ee,ke).call(this),this.setTimeout(()=>{ge(this,re,Ce).call(this)})}get signal(){return Y(this,V).signal}abort(e){return Y(this,V).abort(e)}get isInvalid(){return se.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,r){const n=setInterval(()=>{this.isValid&&e()},r);return this.onInvalidated(()=>clearInterval(n)),n}setTimeout(e,r){const n=setTimeout(()=>{this.isValid&&e()},r);return this.onInvalidated(()=>clearTimeout(n)),n}requestAnimationFrame(e){const r=requestAnimationFrame((...n)=>{this.isValid&&e(...n)});return this.onInvalidated(()=>cancelAnimationFrame(r)),r}requestIdleCallback(e,r){const n=requestIdleCallback((...a)=>{this.signal.aborted||e(...a)},r);return this.onInvalidated(()=>cancelIdleCallback(n)),n}addEventListener(e,r,n,a){var d;r==="wxt:locationchange"&&this.isValid&&Y(this,X).run(),(d=e.addEventListener)==null||d.call(e,r.startsWith("wxt:")?Se(r):r,n,{...a,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),or.debug(`Content script "${this.contentScriptName}" context invalidated`)}},Q=new WeakMap,V=new WeakMap,X=new WeakMap,ee=new WeakSet,ke=function(){window.postMessage({event:F.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName},"*")},re=new WeakSet,Ce=function(){const e=r=>{var n,a;((n=r.data)==null?void 0:n.type)===F.SCRIPT_STARTED_MESSAGE_TYPE&&((a=r.data)==null?void 0:a.contentScriptName)===this.contentScriptName&&this.notifyInvalidated()};addEventListener("message",e),this.onInvalidated(()=>removeEventListener("message",e))},j(F,"SCRIPT_STARTED_MESSAGE_TYPE","wxt:content-script-started"),F);function Z(t,...e){}var gr={debug:(...t)=>Z(console.debug,...t),log:(...t)=>Z(console.log,...t),warn:(...t)=>Z(console.warn,...t),error:(...t)=>Z(console.error,...t)};(async()=>{try{const{main:t,...e}=ar,r=new cr("youtube-ad-blocker",e);await t(r)}catch(t){gr.error('The content script "youtube-ad-blocker" crashed on startup!',t)}})()})();
